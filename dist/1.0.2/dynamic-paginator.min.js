/*!
 * Dynamic Paginator v1.0.1 (https://github.com/alameenlr/dynamic-paginator)
 * Copyright (c) Al-Ameen LR <alameenlr@outlook.com>
 * Licensed under MIT (https://github.com/alameenlr/dynamic-paginator/license.txt)
 */
(function($){var lrs_dynamic_paginator_instances={};$.fn.dynamicPaginator=function(options){let $t=this;let makeLoadRequestParams=function(options){let kv={};let cvv=options.currentViewValues;for(let k in cvv){let tmp=options.dpParamKeys[k];kv[tmp]=cvv[k]}kv["offset"]=cvv.pageNo*cvv.count-cvv.count;return kv};let instancekey=function(length){const characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let result="";const charactersLength=characters.length;for(let i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength))}return"i_"+result};let setInOption=function(instaceId,options){lrs_dynamic_paginator_instances[instaceId]=options};let getInOption=function(instaceId){return lrs_dynamic_paginator_instances[instaceId]??false};let dpg_default_option={search:{placeholder:"Search",disabledItemPropertiesKeys:[]},colorTheme:"auto",getInfoURL:"",loadListURL:"",loadedListIsComplete:false,itemNumberKey:"index",httpRequestHeaders:{},itemProperties:[],indexedItemPropertiesKeys:[],items:[],maxPagerNumbers:10,totalItemsCount:0,setCountsPerPage:[10,20,50,100,250,500,1e3],pushToHistory:true,showViewingStatus:true,currentViewValues:{pageNo:1,count:10},fromStartOnSort:false,dpParamKeys:{pageNo:"page-no",count:"count",orderBy:"order-by",orderByIn:"order-by-in",searchIn:"search-in",searchKey:"search-key",userParams:"user-params"},clientSideSearch:true,clientSideSearchFormat:"%{{search-key}}%",userParamListner:true,viewTemplate:`<div class="d-flex w-100 justify-content-between py-2">`+`<div>{{searchBox}}</div>`+`<div>{{countsPerPage}}</div>`+`</div>`+`<table class="w-100">`+`<thead>`+`<tr>{{propertiesLabel}}</tr>`+`</thead>`+`<tbody>{{itemsList}}</tbody>`+`</table>`+`<div class="d-flex w-100 justify-content-between py-2">`+`<div class="show-status">{{viewingStatus}}</div>`+`<div>{{paginationContent}}</div>`+`</div>`,paginationBlock:{hideOnSinglePage:true,jumpTo:true,size:"default",template:{pageNumber:`<a href="{{url}}" class="page-number">{{pageNo}}</a>`,previous:`<a href="{{url}}" class="page-previous">`+`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M9.4 233.4a32 32 0 0 0 0 45.3l192 192a32 32 0 0 0 45.3-45.3L77.3 256 246.6 86.6a32 32 0 0 0-45.3-45.3l-192 192z" fill="currentColor"/></svg>`+`</a>`,next:`<a href="{{url}}" class="page-next">`+`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M310.6 233.4a32 32 0 0 1 0 45.3l-192 192a32 32 0 0 1-45.3-45.3L242.7 256 73.4 86.6a32 32 0 0 1 45.3-45.3l192 192z" fill="currentColor"/></svg>`+`</a>`,more:`<a class="page-more">...</a>`,jumpTo:`<form action="#">`+`<div class="d-flex border jump-to-box">`+`<input type="number" name="jump-to-page" class="lrs-dpf no-border no-outline no-bg number">`+`<button type="submit" class="no-border no-outline no-bg">Go</button>`+`</div>`+`</form>`,background:true}},pageContentLoader:`<div class='dpg-loading'></div>`,makeItemPropertyLabel:(property,isIndexed,sorted)=>{if(isIndexed)return`<th tabindex="0" role="columnheader button" data-property-key="${property.key}" class="head-sort${sorted?" "+sorted:""}"${sorted?` title=" Sort `+(sorted=="asc"?"descending":"ascending")+`"`:""}>${property.label}</th>`;return`<th data-property-key="${property.key}">${property.label}</th>`},makeItem:(item,itemProperties,searchedIndex,searchedKey)=>{let escapeQuotes=str=>str?.toString().replace(/[\"]/gm,"&quot;").replace(/[\']/gm,"&apos;");let searchMatch=content=>{let matchRex=new RegExp("("+searchedKey.replace(/[\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")","gui");return content.toString().replace(matchRex,"<span class='search-match'>$1</span>")};return`<tr>`+itemProperties.map((p=>searchedIndex==p.key?`<td data-key="${p.key}" data-value="${escapeQuotes(item[p.key])}">${searchMatch(item[p.key])}</td>`:`<td data-key="${p.key}" data-value="${escapeQuotes(item[p.key])}">${item[p.key]}</td>`)).join("")+`</tr>`},makeViewingStatus:(pageno,countsPerPage,totalItemsCount)=>{if(totalItemsCount==0)return"0 entries";let to=pageno*countsPerPage;let from=to-countsPerPage+1;return`Showing ${from} to ${to>totalItemsCount?totalItemsCount:to} of ${totalItemsCount} entries`},makeSearchBox:options=>{if(options.search!=false){let search_op=options.search;let search_sel=``;options.itemProperties.forEach((p=>{search_sel+=options.indexedItemPropertiesKeys.indexOf(p.key)>-1&&options.search.disabledItemPropertiesKeys.indexOf(p.key)<0?`<option value="${p.key}" ${options.currentViewValues.searchIn==p.key?" selected":""}>${p.label}</option>`:``}));return`<form action="#">`+`<div class="d-flex border search-box">`+(search_sel.length>0?`<select name="${options.dpParamKeys.searchIn}" class="no-border no-outline no-bg">`+search_sel+`</select>`:``)+`<input type="text" name="${options.dpParamKeys.searchKey}" placeholder="${search_op.placeholder}" class="lrs-dpf no-border no-outline no-bg" value="${options.currentViewValues.searchKey??""}">`+`<button type="submit" class="no-border no-outline no-bg"><svg width="18" height="14" style="fill:currentColor;opacity:0.3;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7l126.6 126.7c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg></button>`+`</div>`+`</form>`}return""},makeCountSelection:function(fieldname,countsPerPage,totalItemsCount,countSelect){let search_sel=``;countSelect.forEach((n=>{search_sel+=`<option value="${n}" ${n==countsPerPage?" selected":""}>${n}</option>`}));return`<div class="set-view-count">`+`<select name="${fieldname}" class="lrs-dpf border no-bg no-outline">`+search_sel+`</select>`+`<span> Items per page.</span>`+`</div>`}};let currentViewValueKeys=["pageNo","count","orderBy","orderByIn","searchIn","searchKey","userParams"];let DPFNS={getLRSDPGElement:function(name,$e){return $e.find('[data-lrs-dpg-elm="'+name+'"]')},setUserParamsInElement($e,options){for(let k in options.currentViewValues.userParams){$e.find('.dynamic-paginator-input[name="'+k+'"]').val(options.currentViewValues.userParams[k])}},functionNametoFunction:function(option){for(let k in option){if(["makeItemPropertyLabel","makeItem","makeViewingStatus","makeSearchBox","makeCountSelection"].indexOf(k)>-1&&typeof option[k]=="string"){try{let evalue=eval(option[k]);if(!evalue)throw option[k]+":is not defined.";option[k]=evalue}catch(e){console.error(e)}}}return option},generateSortImageURL:function(sort,themeisDark){let svg={pt:"",o:"1",c:"#333333"};if(themeisDark){svg.c="#d4d4d4"}if(sort==false){svg.pt="M4.4 9.8h15.2c.3 0 .6 0 .8-.3.2-.2.3-.5.3-.8s0-.5-.3-.7L12.8.3c-.3-.2-.5-.3-.8-.3s-.5.1-.8.3L3.6 8a1 1 0 0 0-.3.7c0 .3 0 .6.3.8.2.2.5.3.8.3zm15.2 4.4H4.4a1 1 0 0 0-.8.3c-.2.2-.3.5-.3.8s0 .5.3.7l7.6 7.7c.3.2.5.3.8.3s.5-.1.8-.3l7.6-7.7c.2-.2.3-.4.3-.7s0-.6-.3-.8a1 1 0 0 0-.8-.3z";svg.o="0.3"}else if(sort=="asc"){svg.pt="M4.4 17h15.2c.3 0 .6-.2.8-.4.2-.2.3-.5.3-.8a1 1 0 0 0-.3-.8l-7.6-7.6c-.3-.2-.5-.3-.8-.3s-.5.1-.8.3l-7.6 7.7a1 1 0 0 0-.3.7c0 .3 0 .6.3.8.2.2.5.3.8.3z"}else if(sort=="desc"){svg.pt="M19.6 7H4.4a1 1 0 0 0-.8.4c-.2.2-.3.5-.3.8s0 .5.3.8l7.6 7.6c.3.2.5.3.8.3s.5-.1.8-.3l7.6-7.7c.2-.2.3-.4.3-.7s0-.6-.3-.8a1 1 0 0 0-.8-.3z"}if(svg.pt!=""){return'url("data:image/svg+xml,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" xml:space="preserve"><path fill="${svg.c}" fill-opacity="${svg.o}" d="${svg.pt}"/></svg>`)+'")'}return"none"},contentLoader:function($e,options,show){let _ls=DPFNS.getLRSDPGElement("items-list",$e);if(show){if(_ls.parent().find(".lrs-dpg-content-loader").length==0){let loader=document.createElement("div");loader.innerHTML=options.pageContentLoader;let h=_ls.height();loader.style.height=h+"px";loader.style.width=_ls.width()+"px";if(h==0){_ls.addClass("null-loader")}loader.classList.add("lrs-dpg-content-loader");_ls.prepend(loader)}}else{_ls.removeClass("null-loader");$.each(_ls.parent().find(".lrs-dpg-content-loader"),(function(){this.remove()}))}},upadateViewingStatus:function($e,options,pageNo=options.currentViewValues.pageNo,count=options.currentViewValues.count,total=options.totalItemsCount){let _vs=DPFNS.getLRSDPGElement("viewing-status",$e);_vs.html(options.makeViewingStatus(pageNo,count,total))},urlParamsToCurrentViewPageValues:function(gets,options){let kv=options.currentViewValues;for(let k of currentViewValueKeys){let tmp=options.dpParamKeys[k];if(gets[tmp]){if(k=="userParams"){let keyVal=atob(gets[tmp]);keyVal=JSON.parse(keyVal);kv[k]=keyVal}else{let getType=typeof options.currentViewValues[k];if(getType=="number"){kv[k]=parseInt(gets[tmp])??0}else{kv[k]=gets[tmp]}}}}return kv},setOptionFromVars:function(options){options.currentViewValues.count=options.currentViewValues.count??DefaultOptions.dpdefaultOption.currentViewValues.count;if(options.pushToHistory){let url=DPGURLS.splitURLToParams();options.currentViewValues=DPFNS.urlParamsToCurrentViewPageValues(url.gets,options)}return options},makeSearchRegEx:function(key,rexFormat="{{search-key}}%"){key=key.replace(/\%/gi,"!%");rexFormat=rexFormat.replace(/\{\{search-key\}\}/gm,key);rexFormat=rexFormat.replace(/[\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");if(/^%/.test(rexFormat))rexFormat=rexFormat.replace(/^%/,".*");else rexFormat="^"+rexFormat;if(/([^\!]%)$/.test(rexFormat))rexFormat=rexFormat.replace(/%$/,".*");rexFormat=rexFormat.replace(/\!\%/gm,"%");return new RegExp(rexFormat,"giu")},jsTableSearch:function($e,options){let cvv=options.currentViewValues;let e_Sel='[data-lrs-dpg-elm="items-list"]';let listParent=$e.find(e_Sel);let listItems=$e.find(e_Sel+">*");if(cvv.searchKey){let searchIn=options.currentViewValues.searchIn??options.itemProperties[0].key;let getVal=e=>e?.getAttribute("data-value")??e?.textContent??"";let d_Key='[data-key="'+searchIn+'"]';let _nel=document.createElement(listParent[0]?.tagName??"div");let searchRex=DPFNS.makeSearchRegEx(cvv.searchKey??"",options.clientSideSearchFormat);let matchRex=new RegExp("("+cvv.searchKey.replace(/[\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")","gui");let count=0;$.each(listItems,(function(i,e){e.style.removeProperty("display");e?.querySelectorAll(".search-match").forEach((el=>{el.insertAdjacentHTML("beforebegin",el.innerHTML);el.remove()}));let _v=e.querySelector(d_Key);if(getVal(_v).match(searchRex)){e?.querySelectorAll('[data-key="'+searchIn+'"]').forEach((ve=>{ve.innerHTML=getVal(ve)?.replace(matchRex,"<span class='search-match'>$1</span>")}));count++}else{e.style.display="none"}}));triggerEvents.eventPageLoaded($e,options);DPFNS.upadateViewingStatus($e,options,1,count,count)}else{$.each(listItems,(function(i,e){e?.querySelectorAll(".search-match").forEach((el=>{el.insertAdjacentHTML("beforebegin",el.innerHTML);el.remove()}));e.style.removeProperty("display")}));DPFNS.upadateViewingStatus($e,options)}},sortTable:function($e,options){let isInt=true;let e_Sel='[data-lrs-dpg-elm="items-list"]';let d_Key='[data-key="'+options.currentViewValues.orderBy+'"]';let listParent=$e.find(e_Sel);let listItems=$e.find(e_Sel+">*");let _nel=document.createElement(listParent[0]?.tagName??"div");let key_vals=[];$.each(listItems,(function(i,e){let _v=$(e).find(d_Key);let v=_v.attr("data-value")??_v.text()??"";if(!v.match(/[0-9\.]{1,15}/))isInt=false;v=isInt&&!isNaN(parseFloat(v))?parseFloat(v):v.toLowerCase();key_vals.push({p:i,v:v})}));let sortIt=(arr,order)=>{if(order=="desc"){return arr.sort(((x,y)=>x.v>y.v?-1:x.v<y.v?1:0))}else{return arr.sort(((x,y)=>x.v<y.v?-1:x.v>y.v?1:0))}};key_vals=sortIt(key_vals,options.currentViewValues.orderByIn??"asc");key_vals.forEach((v=>{_nel.appendChild(listItems[v.p])}));listParent.html(_nel.innerHTML);_nel.remove();listParent.attr("data-sorted-on",options.currentViewValues.orderBy??"")}};let DPGURLS={splitURLToParams:function(url){let ret={ref:"",gets:{}};url=url?url:window.location.href;url=decodeURIComponent(url);let parts=url.split("?");let gets=parts.length>1?parts.pop():"";ret.ref=parts[0];function parseFinalValue(value){if(Boolean(value)&&typeof value==="object"&&!Array.isArray(value))return keysSorter(value);else{let p=parseFloat(value);if(isNaN(p))return value;else return p%1===0?Math.floor(p):p}}if(gets!=""){let result={};gets=gets.replaceAll("+"," ");let gb=gets.split("&");for(var i=0;i<gb.length;i++){let gv=gb[i].split("=");let key=gv[0];let[obcheck,key_sec]=key.split("[",2);if(key_sec){keyParts.unshift(obcheck);var last=keyParts.pop();keyParts.reduce(((o,k)=>o[k]=o[k]||{}),result)[last]=parseFinalValue(value)}else{result[key]=parseFinalValue(gv[1])}}ret.gets=result}return ret},currentViewPageValuesToURLParams:function(options){let kv={};let cvv=options.currentViewValues;for(let k in cvv){let tmp=options.dpParamKeys[k];if(k=="userParams"){let keyVal=cvv[k];keyVal=JSON.stringify(keyVal);keyVal=btoa(keyVal);kv[tmp]=keyVal}else{kv[tmp]=cvv[k]}}return kv},makeURLFromParams:function(uparms){function stringify(object,options){function stringifyObject(object,options,parentKey=false){const objectCopy={};for(const[key,value]of Object.entries(object)){objectCopy[key]=value}const keys=Object.keys(objectCopy);return keys.map((key=>{const value=object[key];if(parentKey){key=parentKey+"["+key+"]"}if(value===undefined){return""}if(value===null){return encode(key,options)}if(typeof value==="object"){if(Array.isArray(value)){if(value.length===0&&options.arrayFormat==="bracket-separator"){return encode(key,options)+"[]"}return value.reduce(formatter(key),[]).join("&")}let k=stringifyObject(value,options,key);return k.join("&")}return encodeURIComponent(key)+"="+encodeURIComponent(value)}))}if(!object){return""}let strings=stringifyObject(object);return strings.join("&")}let ret=uparms.ref;let gets=stringify(uparms.gets);return ret+(gets.length>0?"?"+gets:"")}};let triggerEvents={eventPageLoaded:function(element,options){element.trigger("page-loaded",[options.currentViewValues])},eventNextClick:function(element,options){element.trigger("next-click",[options.currentViewValues])},eventPreviousClick:function(element,options){element.trigger("prev-click",[options.currentViewValues])},eventCountChanged:function(element,options){element.trigger("count-change",[options.currentViewValues])},eventSorted:function(element,options){element.trigger("sorted",[options.currentViewValues])}};let calcTotalPages=function(options){let n=Math.ceil(options.totalItemsCount/options.currentViewValues.count);return n==0?1:n};let preventDefaultATag=function($a){$a.on("click",(function(e){e.preventDefault()}))};let loadPageAfterUpdateView=function($el,options,onHistoryPoppingLoad=false){let pgElem=DPFNS.getLRSDPGElement("pagination",$el).find(".page-nav");if(options.pushToHistory&&!onHistoryPoppingLoad){let url=DPGURLS.splitURLToParams();let cvv={};$.extend(true,cvv,url.gets,DPGURLS.currentViewPageValuesToURLParams(options));url.gets=cvv;let newUrl=DPGURLS.makeURLFromParams(url);history.pushState({state:newUrl},"null",newUrl)}DPFNS.setUserParamsInElement($el,options);pgElem.html(paginationSection.paginationComponent(options));paginationSection.setJumpToComponentView($el,options);addEventsToButtons($el,instaceId);loadPage(instaceId,$el,options)};let addNumberButtonEvent=function($e,options,$pnb){$pnb.on("click",(function(){options.currentViewValues.pageNo=parseInt($(this).closest(".number").attr("data-page-number"));setInOption(instaceId,options);loadPageAfterUpdateView($e,options)}))};let addMoreButtonEvent=function($e,options,$pnm){let totalPages=calcTotalPages(options);$pnm.on("click",(function(){let $t=$(this);let currentPage=options.currentViewValues.pageNo;let _tmr=$t.closest(".number");let _pr=_tmr.parent();let _prev=_tmr.prev();let prev=parseInt(_prev.attr("data-page-number")??"");let _next=_tmr.next();let next=parseInt(_next.attr("data-page-number")??"");let _cpage=$t.closest(".pagination").find('[data-page-number="'+currentPage+'"]');let side="";let count=0;if(prev>=1&&next<=currentPage){side="L";let _pcp=_cpage.next();if(_pcp.length>0){let k=prev;while(_pcp.length){let pn=_pcp.attr("data-page-number");if(pn==totalPages||k+1==next){break}_pcp.remove();_pcp=_cpage.next();count++;k++}}else{_pcp=_next;let k=prev;while(_pcp.length){let pn=_pcp.attr("data-page-number");if(pn==totalPages||k+1==next){break}_pcp=_pcp.next();_pcp.prev().remove();count++;k++}}}else if(prev==currentPage&&next!=prev+1){side="L";let _pcp=_next;let k=prev;while(_pcp.length){let pn=_pcp.attr("data-page-number");if(pn==totalPages||k+1==next){break}_pcp=_pcp.next();_pcp.prev().remove();count++;k++}}else if(prev>=currentPage&&next>=totalPages){side="R";let _pcp=_cpage.prev();let k=prev;while(_pcp.length){let pn=_pcp.attr("data-page-number");if(pn==1||k+1==next){break}_pcp.remove();_pcp=_cpage.prev();count++;k++}}if(count<next-prev){let _pcp=_prev.prev();while(_pcp.length){let pn=_pcp.attr("data-page-number");if(pn==1||pn==currentPage||count==next-prev){break}_pcp.remove();_pcp=_prev.prev();count++}}if(count<next-prev){let _pcp=_next.next();while(_pcp.lengt){let pn=_pcp.attr("data-page-number");if(pn==totalPages||pn==currentPage||count==next-prev){break}_pcp.remove();_pcp=_next.next();count++}}let nbt=[];while(count>0&&prev<next){nbt.push(paginationSection.makePagerLI(++prev,options));count--}_tmr[0]?.insertAdjacentHTML("beforebegin",nbt.join(""));_tmr[0]?.remove();let pages=[];let previous="0";$.each(_pr.find(".number"),(function(i,p){let _p=$(p);let pn=_p.attr("data-page-number");if(previous==pn){_p.remove()}else{let pnn=parseInt(pn);if(isNaN(pnn)){_p.remove()}else{let prn=parseInt(previous);if(prn+1!==pnn){_p[0]?.insertAdjacentHTML("beforebegin",paginationSection.makePagerLI(prn+2==pnn?prn+1:"...",options))}}pages.push(pnn)}previous=pn??""}));let ii=0;while(_pr.find(".number").length>options.maxPagerNumbers){$.each(_pr.find(".number"),(function(i,p){let _p=$(p);let pn=_p.attr("data-page-number");if(pn=="..."){let _k=_p.prev();let pn=_k.attr("data-page-number");if(pn!=1&&pn!=currentPage&&pn!=totalPages){_k.remove()}}}));if(++ii>10)break}previous="0";$.each(_pr.find(".number"),(function(i,p){let _p=$(p);let pn=_p.attr("data-page-number");if(previous=="..."&&pn=="..."){_p.remove()}previous=pn??""}));addEventsToButtons($e,instaceId)}))};let addEventsToButtons=function($e,instaceId){let options=getInOption(instaceId);let totalPages=calcTotalPages(options);let pgSect=DPFNS.getLRSDPGElement("pagination",$e);let pgElem=pgSect.find(".page-nav");let next=pgElem.find(".page-next");let previous=pgElem.find(".page-previous");let jumpTo=pgSect.find('.jump-to form [name="jump-to-page"]');next[0]?.toggleAttribute("disabled",options.currentViewValues.pageNo==totalPages);previous[0]?.toggleAttribute("disabled",options.currentViewValues.pageNo==1);if(jumpTo.length>0){jumpTo.val(options.currentViewValues.pageNo.toString())}next.on("click",(function(){if(!this.hasAttribute("disabled")){options.currentViewValues.pageNo++;setInOption(instaceId,options);loadPageAfterUpdateView($e,options);triggerEvents.eventNextClick($e,options)}}));previous.on("click",(function(){if(!this.hasAttribute("disabled")){options.currentViewValues.pageNo--;setInOption(instaceId,options);loadPageAfterUpdateView($e,options);triggerEvents.eventPreviousClick($e,options)}}));$.each(pgElem.find("a"),(function(){preventDefaultATag($(this))}));$.each(pgElem.find(".pager .number.pageno>*"),(function(){addNumberButtonEvent($e,options,$(this))}));$.each(pgElem.find(".pager .number.loadmore>*"),(function(){addMoreButtonEvent($e,options,$(this))}))};let addeventListners=function(instaceId,$e,options){let searchBox=DPFNS.getLRSDPGElement("search-box",$e);let count=DPFNS.getLRSDPGElement("count-select",$e);let sortSel=DPFNS.getLRSDPGElement("property-head",$e);$e.find("form").on("submit",(function(e){e.preventDefault()}));searchBox.find("form:not(.e-plus)").addClass("e-plus").on("submit",(async function(e){let options=getInOption(instaceId);let _thf=e.target;let _search_in=_thf?.querySelector('[name="'+options.dpParamKeys.searchIn+'"]');let _search_key=_thf?.querySelector('[name="'+options.dpParamKeys.searchKey+'"]');let searchIn=_search_in.value;let searchKey=_search_key.value;let doJsSearch=false;let previousSearchKey=options.currentViewValues.searchKey??"";let previousSearchIn=options.currentViewValues.searchIn;if(options.clientSideSearch&&(!previousSearchIn||previousSearchIn==searchIn)&&searchKey.length>=previousSearchKey.length&&searchKey.indexOf(previousSearchKey)==0&&options.totalItemsCount<=options.currentViewValues.count){doJsSearch=true}if(searchKey.length==0){options.currentViewValues.searchIn=undefined;options.currentViewValues.searchKey=undefined;doJsSearch=false}else{options.currentViewValues.searchIn=searchIn;options.currentViewValues.searchKey=searchKey}setInOption(instaceId,options);let reqLoad=false;if(doJsSearch){DPFNS.jsTableSearch($e,options)}else if(options.loadedListIsComplete){options.currentViewValues.pageNo=1;let el=DPFNS.getLRSDPGElement("list-data",$e),cvv=options.currentViewValues;if(el.length>0){let uparams=JSON.parse(el.attr("data-user-params"));Object.keys(uparams).forEach((k=>{if(cvv.userParams[k]!=uparams[k]){reqLoad=true;return}}));if(reqLoad==false){loadPageAfterUpdateView($e,options)}}}else{reqLoad=true}if(reqLoad){DPFNS.contentLoader($e,options,true);$.ajax({url:options.getInfoURL,headers:options.httpRequestHeaders,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:makeLoadRequestParams(options),dataType:"json",success:function(resp){options.totalItemsCount=resp.totalItemsCount??0;options.currentViewValues.pageNo=1;$.extend(true,options,resp);options=DPFNS.functionNametoFunction(options);setInOption(instaceId,options);loadPageAfterUpdateView($e,options)},error:function(e){console.log("Unable to fetch the data from getInfoURL:"+options.getInfoURL)}})}}));searchBox.find('form [name="'+options.dpParamKeys.searchKey+'"]:not(.e-plus)').addClass("e-plus").on("input",(function(e){if(this.value.length==0){let options=getInOption(instaceId);options.currentViewValues.searchIn=undefined;options.currentViewValues.searchKey=undefined;setInOption(instaceId,options);$(this).closest("form").submit()}}));$e.find(".jump-to form:not(.e-plus)").addClass("e-plus").on("submit",(function(){let options=getInOption(instaceId);let totalPages=calcTotalPages(options);let _no=$(this).find('[name="jump-to-page"]');let no=parseInt(_no.val());no=isNaN(no)||no<1?1:no>totalPages?totalPages:no;_no.val(no.toString());options.currentViewValues.pageNo=no;setInOption(instaceId,options);loadPageAfterUpdateView($e,options)}));count.find('[name="count"]:not(.e-plus)').addClass("e-plus").on("change",(function(e){let options=getInOption(instaceId);options.currentViewValues.count=parseInt($(this).val());let totalPages=calcTotalPages(options);if(options.currentViewValues.pageNo>totalPages)options.currentViewValues.pageNo=totalPages;triggerEvents.eventCountChanged($e,options);setInOption(instaceId,options);loadPageAfterUpdateView($e,options)}));$.each(sortSel.find(".head-sort:not(.e-plus)"),(function(){$(this).addClass("e-plus");$(this).on("click",(function(){let th=this;let $t=$(th);let pk="data-property-key";let key=th.hasAttribute(pk)?$t.attr(pk)??"":$t.find("["+pk+"]")?.attr(pk)??"";let order=options.currentViewValues.orderByIn;order=order=="asc"?"desc":order=="desc"?"asc":"asc";if(options.currentViewValues.orderBy!=key){order="asc"}options.currentViewValues.orderByIn=order;options.currentViewValues.orderBy=key;setInOption(instaceId,options);$t.addClass(order);$t.removeClass(order=="asc"?"desc":"asc");$.each($t.siblings(),(function(){$(this).removeClass("desc asc")}));if(options.totalItemsCount<=options.currentViewValues.count){DPFNS.sortTable($e,options);triggerEvents.eventSorted($e,options)}else{if(options.fromStartOnSort){options.currentViewValues.pageNo=1;setInOption(instaceId,options)}options.triggerEventSorted=true;loadPageAfterUpdateView($e,options)}}))}));$e.find(".dynamic-paginator-input:not(.e-plus)").addClass("e-plus").on("input",(function(){let options=getInOption(instaceId);let $t=$(this);if(!options.currentViewValues.userParams)options.currentViewValues.userParams={};options.currentViewValues.userParams[$t.attr("name")]=$t.val();setInOption(instaceId,options);if(options.userParamListner){loadPageAfterUpdateView($e,options)}}));addEventsToButtons($e,instaceId);let cr_link_search=document?.location?.search;window?.addEventListener("popstate",(function(ev){let options=getInOption(instaceId);ev.preventDefault();if(cr_link_search!==document?.location?.search){cr_link_search=document?.location?.search;options=DPFNS.setOptionFromVars(options);setInOption(instaceId,options);loadPageAfterUpdateView($e,options,true)}}));if(options.colorTheme=="auto"){window?.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",(event=>{$t.toggleClass("theme-dark",event.matches?true:false)}))}};let loadPage=function(instaceId,$e,options,force){let _ls=DPFNS.getLRSDPGElement("items-list",$e);let load=true;if(options.loadListURL==""){console.error("loadListURL is Empty.",options.loadListURL);return}if(force!==true&&options.loadedListIsComplete){let el=DPFNS.getLRSDPGElement("list-data",$e);if(el.length>0){load=false;let cvv=options.currentViewValues;let data=JSON.parse(el.text());let uparams=JSON.parse(el.attr("data-user-params"));Object.keys(uparams).forEach((k=>{if(cvv.userParams[k]!=uparams[k])load=true}));if(load==false){let sortOrder=cvv.orderByIn??"asc";let sortKey=cvv.orderBy;if(sortOrder=="desc"){data.sort(((x,y)=>x[sortKey]>y[sortKey]?-1:x[sortKey]<y[sortKey]?1:0))}else{data.sort(((x,y)=>x[sortKey]<y[sortKey]?-1:x[sortKey]>y[sortKey]?1:0))}if(cvv.searchKey){let searchIn=cvv.searchIn??options.itemProperties[0].key;let searchRex=DPFNS.makeSearchRegEx(cvv.searchKey??"",options.clientSideSearchFormat);data=data.filter((d=>d[searchIn].match(searchRex)?true:false))}options.totalItemsCount=data.length;let resp=data.slice((cvv.pageNo-1)*cvv.count,cvv.pageNo*cvv.count);_ls.html(resp.map(((e,i)=>{if(options.itemNumberKey!==false)e[options.itemNumberKey]=(cvv.pageNo-1)*cvv.count+i;return options.makeItem(e,options.itemProperties,cvv.searchIn??"",cvv.searchKey??"")})).join(""));if(options.triggerEventSorted){options.triggerEventSorted=undefined;triggerEvents.eventSorted($e,options)}DPFNS.upadateViewingStatus($e,options);triggerEvents.eventPageLoaded($e,options);DPFNS.getLRSDPGElement("pagination",$e).find(".page-nav").html(paginationSection.paginationComponent(options));paginationSection.setJumpToComponentView($e,options);addEventsToButtons($e,instaceId)}}}if(load){if(options.totalItemsCount>0){DPFNS.contentLoader($e,options,true);$.ajax({url:options.loadListURL,headers:options.httpRequestHeaders,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:makeLoadRequestParams(options),dataType:"json",success:function(resp){DPFNS.contentLoader($e,options,false);try{if(Array.isArray(resp)){if(options.loadedListIsComplete){let el=DPFNS.getLRSDPGElement("list-data",$e);if(el.length==0){el=$(`<div style="display:none;" data-lrs-dpg-elm="list-data"></div>`);$e.append(el)}el.text(JSON.stringify(resp));el.attr("data-user-params",JSON.stringify(options.currentViewValues.userParams));options.currentViewValues.pageNo=1;loadPage(instaceId,$e,options);return}_ls.html(resp.map(((e,i)=>{if(options.itemNumberKey!==false)e[options.itemNumberKey]=(options.currentViewValues.pageNo-1)*options.currentViewValues.count+i;return options.makeItem(e,options.itemProperties,options.currentViewValues.searchIn??"",options.currentViewValues.searchKey??"")})).join(""));if(options.triggerEventSorted){options.triggerEventSorted=undefined;triggerEvents.eventSorted($e,options)}DPFNS.upadateViewingStatus($e,options);triggerEvents.eventPageLoaded($e,options)}else{throw"Response is not an array Object"}}catch(e){console.error("Unable to fetch the data from loadListURL:"+options.loadListURL,e);console.log("Response Must be in Array.")}},error:function(e){console.log("Unable to fetch the data from getInfoURL:"+options.getInfoURL)}})}else{DPFNS.upadateViewingStatus($e,options);DPFNS.contentLoader($e,options,false);triggerEvents.eventPageLoaded($e,options);_ls.html("")}}};let paginationSection={makeMakeBt:function(template,pageNo,options,addUrl=true){let btUrl="#";if(pageNo==-1)addUrl=false;if(addUrl){let url=DPGURLS.splitURLToParams();let cvp=DPGURLS.currentViewPageValuesToURLParams(options);cvp[options.dpParamKeys.pageNo]=pageNo;for(let k in cvp){url.gets[k]=cvp[k]}url.gets[options.dpParamKeys.pageNo]=pageNo;btUrl=DPGURLS.makeURLFromParams(url)}let content=template.replace(/\{\{url\}\}/gm,btUrl);content=content.replace(/\{\{pageNo\}\}/gm,pageNo.toString());if(pageNo==options.currentViewValues.pageNo){let _d=document.createElement("div");_d.innerHTML=content;_d.firstElementChild?.classList.add("active");content=_d.innerHTML}return content},makePagerLI:function(pn,options,addClass=""){let pgb=options.paginationBlock;return`<li class="number ${(pn=="..."?"loadmore":"pageno")+" "+addClass}" data-page-number="${pn}">`+(pn=="..."?this.makeMakeBt(pgb.template.more,-1,options,false):this.makeMakeBt(pgb.template.pageNumber,pn,options))+`</li>`},generatePageNumbers:function(totalPages,currentPage,maxItems){let nums=[];let left=[];let right=[];let delta=Math.floor(maxItems/2)-2;let i=0;let k=0;for(i=currentPage-1;i>1&&k<delta;i--,k++)left.unshift(i);for(i=currentPage+1,k=0;i<totalPages&&k<delta;i++,k++)right.push(i);let delta_fill=delta*2-right.length-left.length;if(delta_fill>0){if(right.length<delta){for(i=left[0]-1,k=0;i>1&&k<delta_fill;i--,k++)left.unshift(i)}else if(left.length<delta){for(i=right[right.length-1]+1,k=0;i<totalPages&&k<delta_fill;i++,k++)right.push(i)}}nums=currentPage==1||currentPage==totalPages?left.concat(right):left.concat([currentPage],right);if(currentPage==1&&nums.length>0){let t1=nums[nums.length-1]+1;if(totalPages!=t1)nums.push(t1)}else if(currentPage==totalPages&&nums.length>0){let t1=nums[0]-1;if(t1!=1)nums.unshift(t1)}if(nums[0]-1>=2){if(totalPages-nums[nums.length-1]>=2){nums.shift()}nums.unshift("...")}else if(nums[0]-1>1){nums.unshift(nums[0]-1)}nums.unshift(1);let nli=nums.length-1;if(totalPages-nums[nli]>=2){nums.push("...")}else if(totalPages-nums[nli]>1){nums.push(nums[nli]+1)}if(totalPages>1)nums.push(totalPages);return nums},setJumpToComponentView:function($e,options){let pgSec=DPFNS.getLRSDPGElement("pagination",$e);let totalPages=calcTotalPages(options);let show=totalPages==1&&options.paginationBlock.hideOnSinglePage==true;pgSec.find(".jump-to").toggleClass("d-none",show)},jumpToComponent(options){let totalPages=calcTotalPages(options);if(totalPages==1&&options.paginationBlock.hideOnSinglePage==true)return"";return options.paginationBlock.jumpTo?`<div class="jump-to">`+options.paginationBlock.template.jumpTo+`</div>`:""},paginationComponent(options){let pgb=options.paginationBlock;let totalPages=calcTotalPages(options);if(totalPages==1&&pgb.hideOnSinglePage==true)return"";let currentPage=options.currentViewValues.pageNo;let maxItems=options.maxPagerNumbers;let pnumbers=paginationSection.generatePageNumbers(totalPages,currentPage,maxItems);let previous=paginationSection.makeMakeBt(pgb.template.previous,currentPage==1?-1:currentPage-1,options);let next=paginationSection.makeMakeBt(pgb.template.next,currentPage==totalPages?-1:currentPage+1,options);let pager=`<ul class="pager">`+pnumbers.map((pn=>paginationSection.makePagerLI(pn,options))).join("")+`</ul>`;return`<div class="pagination${options.paginationBlock.template.background==false?" dpg-no-bg":""}">`+previous+pager+next+`</div>`}};let intiatePaginator=function(instanceid,$e,options=false){$e.addClass("lrs-dynamic-paginator");options=options==false?getInOption(instanceid):options;let content=options.viewTemplate??"";if(options.colorTheme=="auto"&&window?.matchMedia&&window?.matchMedia("(prefers-color-scheme: dark)").matches||options.colorTheme=="dark"){$e.addClass("theme-dark")}content=content.replace(/(\>)\{\{propertiesLabel\}\}(\<)/gm," data-lrs-dpg-elm='property-head'$1"+options.itemProperties.map((p=>options.makeItemPropertyLabel(p,options.indexedItemPropertiesKeys.indexOf(p.key)>-1,options.currentViewValues?.orderBy==p.key?options.currentViewValues?.orderByIn:false))).join("")+"$2");content=content.replace(/(\>)\{\{itemsList\}\}(\<)/gm," data-lrs-dpg-elm='items-list'$1"+"$2");content=content.replace(/(\>)\{\{viewingStatus\}\}(\<)/gm," data-lrs-dpg-elm='viewing-status'$1"+"$2");content=content.replace(/(\>)\{\{searchBox\}\}(\<)/gm," data-lrs-dpg-elm='search-box'$1"+options.makeSearchBox(options)+"$2");if(options.setCountsPerPage!=false){let counts=options.setCountsPerPage;content=content.replace(/(\>)\{\{countsPerPage\}\}(\<)/gm," data-lrs-dpg-elm='count-select'$1"+options.makeCountSelection(options.dpParamKeys.count,options.currentViewValues.count,options.totalItemsCount,counts)+"$2")}content=content.replace(/(\>)\{\{paginationContent\}\}(\<)/gm," data-lrs-dpg-elm='pagination'$1<div class='d-flex'><div class='page-nav'>"+paginationSection.paginationComponent(options)+"</div>"+paginationSection.jumpToComponent(options)+"$2");$e.html(content);$e.prepend(`<style>`+['.lrs-dynamic-paginator.theme-dark [data-lrs-dpg-elm="property-head"]','.lrs-dynamic-paginator [data-lrs-dpg-elm="property-head"]'].map(((b,i)=>[false,"asc","desc"].map((c=>b+" .head-sort"+(c==false?"":"."+c)+"{"+"background-image:"+DPFNS.generateSortImageURL(c,i==0)+"}")).join(""))).join("")+`</style>`);if(options.currentViewValues.userParams){DPFNS.setUserParamsInElement($e,options)}$.each($e.find(".dynamic-paginator-input[name]"),(function(i,e){let k=e.name;let v=e.value;options.currentViewValues.userParams=options.currentViewValues?.userParams??{};options.currentViewValues.userParams[k]=v}));setInOption(instaceId,options);loadPage(instaceId,$e,options);addeventListners(instaceId,$e,options)};let newOption={};let instaceId=instancekey(15);$.extend(true,newOption,dpg_default_option,options);$t.attr("data-lrsdpg-instance",instaceId);newOption=DPFNS.setOptionFromVars(newOption);let freshLoad=function(instaceId,options){if(options.getInfoURL==""){options=DPFNS.functionNametoFunction(options);setInOption(instaceId,$t,options);intiatePaginator(instaceId,$t,options)}else{$.ajax({url:options.getInfoURL,headers:options.httpRequestHeaders,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:makeLoadRequestParams(options),dataType:"json",success:function(resp){$.extend(true,options,resp);options=DPFNS.functionNametoFunction(options);options=DPFNS.setOptionFromVars(options);setInOption(instaceId,options);intiatePaginator(instaceId,$t,options)},error:function(e){console.log("Unable to fetch the data from getInfoURL:"+options.getInfoURL)}})}};freshLoad(instaceId,newOption);this.reload=function(){let newOption=getInOption(instaceId);freshLoad(instaceId,newOption);return this};this.reloadList=function(){let newOption=getInOption(instaceId);let getEl=DPFNS.getLRSDPGElement;let $pgel=getEl("pagination",$t).find(".page-nav");let $cs=getEl("count-select",$t);if($cs){$cs.html(newOption.makeCountSelection(newOption.dpParamKeys.count,newOption.currentViewValues.count,newOption.totalItemsCount,newOption.setCountsPerPage))}let $sb=getEl("search-box",$t);if($sb){$sb.html(newOption.makeSearchBox(newOption))}let $ph=getEl("property-head",$t);if($ph){$ph.html(newOption.itemProperties.map((p=>newOption.makeItemPropertyLabel(p,newOption.indexedItemPropertiesKeys.indexOf(p.key)>-1,newOption.currentViewValues?.orderBy==p.key?newOption.currentViewValues?.orderByIn:false))).join(""))}if(newOption.getInfoURL==""){$pgel.html(paginationSection.paginationComponent(newOption));paginationSection.setJumpToComponentView($t,newOption);addeventListners(instaceId,$t,newOption);loadPage(instaceId,$t,newOption)}else{DPFNS.contentLoader($t,newOption,true);$.ajax({url:newOption.getInfoURL,headers:newOption.httpRequestHeaders,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:makeLoadRequestParams(newOption),dataType:"json",success:function(resp){$.extend(true,newOption,resp);newOption=DPFNS.functionNametoFunction(newOption);newOption=DPFNS.setOptionFromVars(newOption);setInOption(instaceId,newOption);$pgel.html(paginationSection.paginationComponent(newOption));paginationSection.setJumpToComponentView($t,newOption);addeventListners(instaceId,$t,newOption);loadPage(instaceId,$t,newOption,true)},error:function(e){console.log("Unable to fetch the data from getInfoURL:"+newOption.getInfoURL)}})}return this};this.setViewValues=function(pageNo,count,orderBy,orderByIn,searchIn,searchKey){let newOption=getInOption(instaceId);pageNo=parseInt(pageNo);if(pageNo>0){newOption.currentViewValues.pageNo=pageNo}count=parseInt(count);if(count>0){newOption.currentViewValues.count=count}if(typeof orderBy=="string")newOption.currentViewValues.orderBy=orderBy;if(orderByIn=="asc"||orderByIn=="desc"){newOption.currentViewValues.orderByIn=orderByIn}if(typeof searchIn=="string")newOption.currentViewValues.searchIn=searchIn;if(typeof searchKey=="string")newOption.currentViewValues.searchKey=searchKey;setInOption(instaceId,newOption);return this};this.refreshList=function(){let newOption=getInOption(instaceId);loadPageAfterUpdateView($t,newOption);return this};this.instaceId=instaceId;return this}})(jQuery);